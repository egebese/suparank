---
import type { CollectionEntry } from 'astro:content';
import GradientHero from './GradientHero.astro';
import CategoryBadge from './CategoryBadge.astro';
import AuthorCard from './AuthorCard.astro';
import { formatDate, getAuthor } from '../../lib/blog';

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const { title, description, category, publishedAt, author: authorSlug, heroImage } = post.data;
const author = await getAuthor(authorSlug);
---

<article class="group">
  <a href={`/blog/${post.id}`} class="block">
    <!-- Hero Image -->
    {heroImage ? (
      <img
        src={heroImage}
        alt={title}
        class="aspect-[16/10] w-full object-cover rounded-sm border border-border mb-4 transition-all duration-300 group-hover:border-muted-foreground/30"
        loading="lazy"
      />
    ) : (
      <GradientHero
        category={category}
        slug={post.id}
        class="aspect-[16/10] rounded-sm overflow-hidden border border-border mb-4 transition-all duration-300 group-hover:border-muted-foreground/30"
      />
    )}

    <!-- Content -->
    <div class="space-y-3">
      <!-- Category -->
      <CategoryBadge category={category} />

      <!-- Title -->
      <h3 class="text-lg font-semibold text-foreground group-hover:text-primary transition-colors line-clamp-2">
        {title}
      </h3>

      <!-- Description -->
      <p class="text-sm text-muted-foreground line-clamp-2">
        {description}
      </p>
    </div>
  </a>

  <!-- Footer with Author and Date -->
  <div class="flex items-center justify-between mt-4 pt-4 border-t border-border">
    {author && (
      <AuthorCard
        author={author.data}
        href={`/blog/authors/${author.data.slug}`}
        size="sm"
      />
    )}
    <time datetime={publishedAt.toISOString()} class="text-xs text-muted-foreground">
      {formatDate(publishedAt)}
    </time>
  </div>
</article>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
