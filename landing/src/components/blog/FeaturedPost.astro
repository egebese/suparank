---
import type { CollectionEntry } from 'astro:content';
import GradientHero from './GradientHero.astro';
import CategoryBadge from './CategoryBadge.astro';
import AuthorCard from './AuthorCard.astro';
import { formatDate, getAuthor } from '../../lib/blog';

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const { title, description, category, publishedAt, author: authorSlug, readingTime, heroImage } = post.data;
const author = await getAuthor(authorSlug);
---

<article class="group grid lg:grid-cols-2 gap-6 lg:gap-10">
  <!-- Hero Image -->
  <a href={`/blog/${post.id}`} class="block">
    {heroImage ? (
      <img
        src={heroImage}
        alt={title}
        class="aspect-[16/10] lg:aspect-[4/3] w-full object-cover rounded-sm border border-border transition-all duration-300 group-hover:border-muted-foreground/30"
        loading="lazy"
      />
    ) : (
      <GradientHero
        category={category}
        slug={post.id}
        class="aspect-[16/10] lg:aspect-[4/3] rounded-sm overflow-hidden border border-border transition-all duration-300 group-hover:border-muted-foreground/30"
      />
    )}
  </a>

  <!-- Content -->
  <div class="flex flex-col justify-center space-y-4">
    <!-- Meta row -->
    <div class="flex items-center gap-3">
      <CategoryBadge category={category} size="md" />
      <span class="text-xs text-muted-foreground">
        {readingTime ? `${readingTime} min read` : ''}
      </span>
    </div>

    <!-- Title -->
    <a href={`/blog/${post.id}`}>
      <h2 class="text-2xl md:text-3xl font-semibold text-foreground group-hover:text-primary transition-colors">
        {title}
      </h2>
    </a>

    <!-- Description -->
    <p class="text-muted-foreground text-base md:text-lg leading-relaxed">
      {description}
    </p>

    <!-- Author and Date -->
    <div class="flex items-center justify-between pt-4 border-t border-border">
      {author && (
        <AuthorCard
          author={author.data}
          href={`/blog/authors/${author.data.slug}`}
          size="md"
        />
      )}
      <time datetime={publishedAt.toISOString()} class="text-sm text-muted-foreground">
        {formatDate(publishedAt)}
      </time>
    </div>
  </div>
</article>
