---
import Layout from './Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

interface Props {
  title: string;
  description: string;
  metaTitle?: string;
  metaDescription?: string;
  canonical?: string;
  ogType?: 'website' | 'article';
  ogImage?: string;
  publishedTime?: Date;
  modifiedTime?: Date;
  author?: string;
  noindex?: boolean;
}

const {
  title,
  description,
  metaTitle,
  metaDescription,
  canonical,
  ogType = 'website',
  ogImage = '/og.jpeg',
  publishedTime,
  modifiedTime,
  author,
  noindex = false,
} = Astro.props;

const siteUrl = Astro.site?.toString().replace(/\/$/, '') || 'https://suparank.io';
const currentUrl = new URL(Astro.url.pathname, siteUrl).toString();
const canonicalUrl = canonical || currentUrl;
const finalMetaTitle = metaTitle || title;
const finalMetaDescription = metaDescription || description;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={finalMetaDescription} />
    <meta name="generator" content={Astro.generator} />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/branding/favicon.png" />
    <link rel="apple-touch-icon" href="/branding/favicon.png" />

    <!-- Canonical -->
    <link rel="canonical" href={canonicalUrl} />

    <!-- Robots -->
    {noindex && <meta name="robots" content="noindex, follow" />}

    <!-- Open Graph -->
    <meta property="og:title" content={finalMetaTitle} />
    <meta property="og:description" content={finalMetaDescription} />
    <meta property="og:type" content={ogType} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:image" content={new URL(ogImage, siteUrl).toString()} />
    <meta property="og:site_name" content="Suparank" />

    {ogType === 'article' && publishedTime && (
      <meta property="article:published_time" content={publishedTime.toISOString()} />
    )}
    {ogType === 'article' && modifiedTime && (
      <meta property="article:modified_time" content={modifiedTime.toISOString()} />
    )}
    {ogType === 'article' && author && (
      <meta property="article:author" content={author} />
    )}

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={finalMetaTitle} />
    <meta name="twitter:description" content={finalMetaDescription} />
    <meta name="twitter:image" content={new URL(ogImage, siteUrl).toString()} />
    <meta name="twitter:site" content="@suparankHQ" />

    <title>{finalMetaTitle}</title>

    <!-- JSON-LD Schemas (injected via slot) -->
    <slot name="head" />

    <!-- React Grab - Development only -->
    <script>
      if (import.meta.env.DEV) {
        import('react-grab');
      }
    </script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-F5PSDZS7SD"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-F5PSDZS7SD');
    </script>
  </head>
  <body class="min-h-screen">
    <!-- Grid lines overlay -->
    <div class="fixed inset-0 pointer-events-none z-50" aria-hidden="true">
      <div class="h-full mx-auto max-w-[1280px] relative">
        <div class="absolute left-0 top-0 bottom-0 w-px bg-border"></div>
        <div class="absolute right-0 top-0 bottom-0 w-px bg-border"></div>
      </div>
    </div>

    <div class="relative z-10">
      <Header />
      <main class="pt-16">
        <slot />
      </main>
      <Footer />
    </div>
  </body>
</html>

<style is:global>
  @import '../styles/global.css';

  /* Blog prose styles */
  .prose {
    @apply text-foreground/90 leading-relaxed;
  }

  .prose h1, .prose h2, .prose h3, .prose h4 {
    @apply text-foreground font-semibold mt-8 mb-4;
    scroll-margin-top: 5rem;
  }

  .prose h2 {
    @apply text-2xl;
  }

  .prose h3 {
    @apply text-xl;
  }

  .prose h4 {
    @apply text-lg;
  }

  .prose p {
    @apply mb-4;
  }

  .prose a {
    @apply text-primary hover:text-primary-light transition-colors underline underline-offset-2;
  }

  .prose ul, .prose ol {
    @apply mb-4 pl-6;
  }

  .prose ul {
    @apply list-disc;
  }

  .prose ol {
    @apply list-decimal;
  }

  .prose li {
    @apply mb-2;
  }

  .prose blockquote {
    @apply border-l-4 border-primary/50 pl-4 my-6 italic text-muted-foreground;
  }

  .prose hr {
    @apply my-8 border-border;
  }

  .prose img {
    @apply rounded-sm border border-border my-6;
  }

  .prose strong {
    @apply font-semibold text-foreground;
  }

  .prose code:not(pre code) {
    @apply bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-primary;
  }

  /* Code blocks handled by expressive-code */
  .prose pre {
    @apply my-6;
  }
</style>
