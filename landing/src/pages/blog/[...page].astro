---
import type { GetStaticPaths } from 'astro';
import BlogLayout from '../../layouts/BlogLayout.astro';
import PostCard from '../../components/blog/PostCard.astro';
import Pagination from '../../components/blog/Pagination.astro';
import { getPublishedPosts, paginate } from '../../lib/blog';
import { categories, type CategoryKey } from '../../content/config';

export const getStaticPaths: GetStaticPaths = async () => {
  const POSTS_PER_PAGE = 9;
  const allPosts = await getPublishedPosts();

  // Skip the first post (featured) for pagination
  const postsForPagination = allPosts.slice(1);
  const totalPages = Math.ceil(postsForPagination.length / POSTS_PER_PAGE);

  // Generate paths for page/2, page/3, etc. (page 1 is handled by index.astro)
  const paths = [];
  for (let page = 2; page <= totalPages; page++) {
    paths.push({
      params: { page: `page/${page}` },
      props: { page },
    });
  }

  return paths;
};

interface Props {
  page: number;
}

const { page } = Astro.props;
const POSTS_PER_PAGE = 9;

const allPosts = await getPublishedPosts();
const postsForPagination = allPosts.slice(1); // Exclude featured

const { data: paginatedPosts, totalPages, currentPage } = paginate(postsForPagination, page, POSTS_PER_PAGE);

const title = `Blog - Page ${page} - Suparank`;
const description = 'Insights, guides, and updates on SEO, content strategy, and AI-powered content creation.';
---

<BlogLayout
  title={title}
  description={description}
  metaTitle={`Blog - Page ${page} | Suparank`}
  metaDescription={description}
  canonical={`https://suparank.io/blog/page/${page}`}
>
  <div class="container mx-auto px-6 py-12 md:py-16">
    <!-- Header -->
    <header class="mb-12 md:mb-16">
      <span class="section-label mb-3 block">Blog</span>
      <h1 class="text-3xl md:text-4xl lg:text-5xl font-semibold text-foreground mb-4">
        All articles
      </h1>
      <p class="text-lg text-muted-foreground">
        Page {page} of {totalPages}
      </p>
    </header>

    <!-- Post Grid -->
    <section>
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8 md:gap-10">
        {paginatedPosts.map((post) => (
          <PostCard post={post} />
        ))}
      </div>

      <Pagination
        currentPage={currentPage}
        totalPages={totalPages}
        baseUrl="/blog"
      />
    </section>
  </div>
</BlogLayout>
